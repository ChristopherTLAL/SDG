---
import MainLayout from '../../layouts/MainLayout.astro';
import { getCategoryPosts } from '../../lib/sanity/queries';
import { client } from '../../lib/sanity/client';
import groq from 'groq';

export async function getStaticPaths() {
  // 拉所有 category 的 slug
  const cats = await client.fetch(
    groq`*[_type == "category" && defined(slug.current)][]{ "slug": slug.current }`
  );
  return cats.map(({ slug }) => ({ params: { category: slug } }));
}

const { category } = Astro.params;
const posts = await getCategoryPosts(category!);
---

<MainLayout title={`Category — ${category}`} description="">
  <section class="grid gap-8">
    {posts.length ? posts.map(p => (
      <article class="border-b pb-6">
        <h2 class="text-xl font-bold"><a href={`/post/${p.slug}`}>{p.title}</a></h2>
        {p.excerpt && <p class="text-neutral-600 mt-2">{p.excerpt}</p>}
      </article>
    )) : <p>该分类暂无文章。</p>}
  </section>
</MainLayout>
